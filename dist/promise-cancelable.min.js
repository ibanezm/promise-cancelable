!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.Cancelable=e.Cancelable||{})}(this,function(e){"use strict";var n=function(){function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}}();function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}require("promise.prototype.finally/auto");var o="@@Cancelable",f=function(e){function n(){t(this,n);var e=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"Cancelable was canceled"));return e.name="CancelationError",e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Error),n}(),r=function(){function u(e){var r=this;if(t(this,u),this.canceled=!1,this.children=null,this.onCancel=null,this.parent=null,"function"!=typeof e)throw new TypeError("Cancelable resolver undefined is not a function");Object.defineProperty(this,o,{value:!0,writable:!1,readable:!0}),this.promise=new Promise(function(n,t){r._reject=t,new Promise(function(n,t){e(function(e){n(e)},function(e){t(e)},function(e){r.onCancel=e})}).then(function(e){n(e)}).catch(function(e){t(e)})})}return n(u,[{key:"cancel",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},n=this;if(!n.isCanceled())for(;n;){var t=n;if(n.children){var r=!0,o=!1,i=void 0;try{for(var l,a=n.children[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var c=l.value;u.isCancelable(c)&&(c.cancel(),c=null)}}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}n.children=null}n.setCanceled(),n.onCancel&&"function"==typeof n.onCancel&&n.onCancel(e),n.parent||n._reject(new f),n=t.parent,t=null}}},{key:"catch",value:function(){var e,n=u.resolve((e=this.promise).catch.apply(e,arguments));return n.parent=this,n}},{key:"isCanceled",value:function(){return this.canceled}},{key:"setCanceled",value:function(){this.canceled=!0}},{key:"then",value:function(){var e,n=u.resolve((e=this.promise).then.apply(e,arguments));return n.parent=this,n}},{key:"finally",value:function(){var e,n=u.finally((e=this.promise).finally.apply(e,arguments));return n.parent=this,n}}],[{key:"all",value:function(e){var n=u.resolve(Promise.all(e)),t=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(t=(i=l.next()).done);t=!0){var a=i.value;u.isCancelable(a)&&(n.children?n.children.push(a):n.children=[a])}}catch(e){r=!0,o=e}finally{try{!t&&l.return&&l.return()}finally{if(r)throw o}}return n}},{key:"isCancelable",value:function(e){return!(!e||!e[o])}},{key:"race",value:function(e){var n=u.resolve(Promise.race(e)),t=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(t=(i=l.next()).done);t=!0){var a=i.value;u.isCancelable(a)&&(n.children?n.children.push(a):n.children=[a])}}catch(e){r=!0,o=e}finally{try{!t&&l.return&&l.return()}finally{if(r)throw o}}return n}},{key:"resolve",value:function(n){return u.isCancelable(n)?n:new u(function(e){e(n)})}},{key:"finally",value:function(n){return u.isCancelable(n)?n:new u(function(e){e(n)})}},{key:"reject",value:function(e){return u.resolve(Promise.reject(e))}}]),u}();e.CancelationError=f,e.default=r,Object.defineProperty(e,"__esModule",{value:!0})});
